---
import Badge from '../components/Badge.astro'
import InstagramIcon from './Icons/InstagramIcon.astro';
---

<div class="mb-5 w-full">
    <h3 class="text-xs md:text-sm font-semibold text-gray-400 mb-4">PROYECTO</h3>
    <div class="flex mb-5 gap-x-12 md:gap-x-44">
        <div class="flex flex-row items-center gap-x-2">
            <a href="https://www.instagram.com/coming.gigs/"><InstagramIcon class="size-4"/></a>
            <a href="https://www.instagram.com/coming.gigs/"><h2 class="text-sm md:text-base ml-1">Coming Gigs</h2></a>
        </div>
        <div>
            <button class="demobtn font-semibold"><Badge>ver proyecto</Badge></button>
        </div>
    </div>
    <div class="demo-container">
        <div class="demo-modal">
            <div class="flex flex-col mb-3">
                <button class="text-black self-end btn-modal text-base font-semibold">cerrar</button>
            </div>
            <!-- CAMBIADO: Removido src, agregado data-src y preload="none" -->
            <video 
                controls 
                muted="muted" 
                class="w-full" 
                data-src="/coming-gigs-demo.mp4"
                preload="none"
                id="demo-video">
                <!-- Fallback para navegadores que no soporten MP4 -->
                <p>Tu navegador no soporta video HTML5.</p>
            </video>
        </div>
    </div>
</div>

<style is:global>
    .demo-container{
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #111111bd;
        display: flex;
        opacity: 0;
        pointer-events: none;
    }
    .demo-modal{
        margin: auto;
        width: 80%;
        background-color: #FFF;
        border-radius: 6px;
        padding: 1em
    }
    .modal--show{
        opacity: 1;
        pointer-events: inherit;
    }
</style>

<script>
    const show: HTMLButtonElement | null = document.querySelector(".demobtn")
    if (show) {
        show.addEventListener("click", () => {
            const demo: HTMLElement | null = document.querySelector(".demo-container")
            const video: HTMLVideoElement | null = document.querySelector("#demo-video")
            
            if(demo){
                demo.classList.add('modal--show')
                
                // NUEVO: Cargar video solo cuando se abre el modal
                if(video && !video.src && video.dataset.src) {
                    video.src = video.dataset.src
                    video.load() // Forzar la carga
                }
            }
        });
    }

    const hidde: HTMLButtonElement | null = document.querySelector(".btn-modal")
    if (hidde) {
        hidde.addEventListener("click", () => {
            const demo: HTMLElement | null = document.querySelector(".demo-container")
            const video: HTMLVideoElement | null = document.querySelector("#demo-video")
            
            if(demo){
                demo.classList.remove('modal--show')
                
                // OPCIONAL: Pausar video al cerrar modal para ahorrar recursos
                if(video) {
                    video.pause()
                }
            }
        });
    }
</script>